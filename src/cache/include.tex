\chapter{内存外置-缓存设计}



核心思路：层级缓存

\section{纯kv设计}
\section{可持久化kv设计}
\subsection{优化写}
假设内存不够，需要硬盘支持。

完整的lsm设计。bloomfilter


\subsection{优化读}
B+tree

WAL，snapshot。

skiplist

\subsection{总结}
最后发现和业务系统的实现完全一样。只是状态为kv。rocksdb。


\section{kv分区}
一致性哈希

\section{基于缓存的实时查询}
外置缓存会有延时，需要和内部缓存一起解决

对于不在的情况可以用bloomfilter加速。内部缓存不在，bloomfilter不在，就不用查外部缓存了。

核心思路：再加一层缓存。