\documentclass[reqno,heading=true,fontset=macnew]{ctexbook}



\usepackage{amssymb}
\usepackage{latexsym}



% algorithm
\usepackage{algpseudocode}
\usepackage[section]{algorithm}
\usepackage{algorithmicx}
\usepackage[colorlinks,linkcolor=red,anchorcolor=blue,citecolor=green]{hyperref}
\usepackage{tikz}
\usepackage{multirow}
\usepackage{float}

% math theorem, lemma, proof
\usepackage{amsthm}
%\theoremstyle{definition}
%\newtheorem{definition}{Definition}
%\newtheorem{theorem}{Theorem}

\usepackage{thmtools}
\declaretheorem{theorem}
\declaretheorem{definition}
\declaretheorem{example}
\declaretheorem{axiom}



% for mathematical integratoin
\usepackage{commath}


% for drawing beautiful math commutative diagram
% note:
%   it treat nodes as a matrix and use "&" to separate row and "\\" for line.
%   "'" change the label from above arrow to below arrow.
%   "l", "r" and "d" means move among matrix nodes.
\usepackage{tikz-cd}


% create index
\usepackage{mathtools}
\usepackage{makeidx}
\makeindex


\usepackage{listings}



% set font



%! TEX program = xelatex
\usepackage{fontspec}
%\setmainfont{PingFang SC}
%\setsansfont{Hiragino Sans GB}
%\setmonofont[Scale=0.9]{PingFang SC}
\usepackage{xeCJK}
%\setCJKmainfont{PingFang SC}
\setCJKmainfont{STKaiti}
\setCJKsansfont{PingFang SC}
\setCJKmonofont{PingFang SC}



% no space in itemize
\usepackage{enumitem}
\setenumerate{itemsep=0pt,partopsep=0pt,parsep=\parskip,topsep=2pt}
\setitemize{itemsep=0pt,partopsep=0pt,parsep=\parskip,topsep=2pt}
\setdescription{itemsep=0pt,partopsep=0pt,parsep=\parskip,topsep=2pt}


% set line space
\usepackage{setspace}



% set page size
\usepackage{geometry}
%\geometry{a4paper}
\geometry{a4paper,top=2cm,bottom=2cm,left=2.5cm,right=2cm}


% set programming code highlight
% \usepackage[chapter]{minted}


% setup bibtex
\usepackage{cite}


\usepackage{epigraph}



\newcommand\cindex[1]{\textcolor{blue}{\textbf{#1}}\index{#1}}


% set toc and section level
\setcounter{secnumdepth}{7}
\setcounter{tocdepth}{7}





% start of the document  
\begin{document}

\title{分布式系统原理}
\author{任杰}
\date{\today}

\maketitle
\tableofcontents


\chapter*{序}
十多年前我第一次走出校园正式从事软件开发工作。当时的一个任务是写一个批处理程序。这个程序有三个进程，需要在三台不同机器上运行。这些进程之间有先后依赖关系，需要按照特定的顺序启动。当时还没有zookeeper，也没有etcd，Raft算法还没有被发明。当时试了很多方法都没有作用。最后只能靠人来手动维护进程状态。如果发现进程因为启动顺序错误报警的话手动重启正确的进程。


之后我就换了组，慢慢的就把这件事情遗忘了。大概一年多以后我突然想起了这个曾经让我头疼的问题。于是我请教了现在维护这个程序的开发人员。他很开心的给我展示了他的新解决方案。他做了一个很小的改动。之前每个进程如果发现所依赖的进程没有启动的话会出错退出。他把出错逻辑改成了一直重启，这样总有一次会有一个进程能启动正确，多来几次的话三个进程都能启动正确。我想了一想好像是这个道理。当时有一点不甘心。我可以写操作系统和编译器，却为什么连三个进程怎么正确启动都做不到。


多年以后我带着这个疑问进入了互联网的世界。这时候才发现我之前碰到的是分布式系统的一个简单到不能再简单的问题。分布式系统有它特定的领域问题和解决方案。对于做工程的人来说大多数情况下这些问题都有固定的解题套路。但是市面上缺乏能把问题解释的比较清楚的教材。这便是这本书背后的动机。

\rightline{任杰}
\rightline{上海浦东}
\rightline{2020年5月}




%\setcounter{page}{1}

\chapter{基础概念}

\epigraph{A distributed system is one in which the failure of a computer you didn't even know existed can render your own computer unusable}{Leslie Lamport \\ Email message sent to a DEC SRC bulletin board at 12:23:29 PDT on 28 May 87.}
\input{intro/basics}




\chapter{时间}
\section{物理时间}

GPS，NTP

\section{逻辑时间}
Lamport Time， Vector clock

\chapter{一致性}
\section{顺序一致性}

\section{线性一致性}
\section{ACID}

\section{最终一致性}


\chapter{共识算法}
\section{定义}

\section{Raft}
\section{Paxos及其它}

\section{复制状态机}


\chapter{数据复制}
\section{同步复制}

\section{异步复制}

\section{Quorun}

\section{一致性复制}


\chapter{数据切割}
\section{切割原则}

\section{一致性哈希}


\chapter{混沌工程}

\chapter{分布式系统案例}

\section{TCP}
\section{DNS}

\section{CDN}

\section{Spanner}

\section{Kafka}







\bibliography{../../bibtex/library}{}
\bibliographystyle{alpha}


\printindex

\end{document}
